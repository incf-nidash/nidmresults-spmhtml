language: python
# use container-based infrastructure
sudo: required
services:
  - docker
cache:
  pip: true
  timeout: 1000
python:
  - "3.5"
bundler_args: --retry 9
# command to install dependencies, e.g. pip install -r requirements.txt --use-mirrors
install: 
 - pip install --upgrade setuptools
 - cd test
# Download Octave-Statistics
 - hg clone http://hg.code.sf.net/p/octave/statistics octave-statistics
# Download MoxUnit for unit testing
 - git clone https://github.com/MOxUnit/MOxUnit.git
 - cd ..
# Download data
 - wget https://neurovault.org/collections/2210/download
 - cd NIDM-Results\ 1.3.0\ examples\ -\ nidmfsl\ 1.2.01\ and\ SPM12\ r6906/
 - mv * ../*
 - cd ..
 - rm -r NIDM-Results\ 1.3.0\ examples\ -\ nidmfsl\ 1.2.01\ and\ SPM12\ r6906/
script:  
 - docker version
 # Run docker snapshot of dev octave (until 4.4 is released)
 - did=$(sudo docker run -ti -d --rm -v `pwd`:/spmviewer cmaumet/octave-spm)
 # Run tests in Octave
 - sudo docker exec -it $did octave --no-window-system --eval "addpath(genpath('/spmviewer')); runTest()"
before_install:
 # Update docker version
 - sudo apt-get update
 - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
 - git config --global user.name "TravisCI"
 - git config --global user.email "travis@dummy.com"
 - sudo docker pull cmaumet/octave-spm
